<!-- All-Time P&L Banner -->
{% if alltime %}
<div class="stat-card" style="border-left:4px solid {{ '#22c55e' if alltime.equity_change >= 0 else '#ef4444' }};">
    <div class="stat-label">All-Time P&L</div>
    <div class="stat-value {{ 'positive' if alltime.equity_change >= 0 else 'negative' }}" style="font-size:28px;">
        {{ "+" if alltime.equity_change >= 0 else "" }}A${{ "%.2f" | format(alltime.equity_change) }}
        <span class="stat-change {{ 'text-success' if alltime.equity_change_pct >= 0 else 'text-danger' }}" style="font-size:15px;">
            ({{ "+" if alltime.equity_change_pct >= 0 else "" }}{{ "%.2f" | format(alltime.equity_change_pct) }}%)
        </span>
    </div>
    <div class="stat-breakdown" style="margin-top:6px;">
        Started: A${{ "%.0f" | format(alltime.starting_capital) }}
        &nbsp;&rarr;&nbsp;
        Now: A${{ "%.0f" | format(alltime.current_equity) }}
    </div>
    <div class="stat-breakdown" style="margin-top:4px;">
        Realised: {{ "+" if alltime.realised_pnl >= 0 else "" }}A${{ "%.2f" | format(alltime.realised_pnl) }}
    </div>
    <div style="display:flex; gap:20px; margin-top:12px;">
        <div>
            <div class="stat-label">Wins</div>
            <div class="stat-value positive" style="font-size:20px;">{{ alltime.wins }}</div>
        </div>
        <div>
            <div class="stat-label">Losses</div>
            <div class="stat-value negative" style="font-size:20px;">{{ alltime.losses }}</div>
        </div>
        <div>
            <div class="stat-label">Win Rate</div>
            <div class="stat-value {{ 'positive' if alltime.win_rate >= 50 else 'text-warning' if alltime.win_rate >= 40 else 'negative' }}" style="font-size:20px;">
                {{ "%.0f" | format(alltime.win_rate) }}%
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Per-Broker Cards -->
{% if broker_stats and broker_stats|length > 0 %}
{% for bid, bs in broker_stats.items() %}
<div class="stat-card" style="padding:14px;">
    <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
        <span class="badge {{ 'badge-warning' if bid == 'binance' else 'badge-info' }}">{{ bid|upper }}</span>
    </div>
    <div class="stat-label">Equity</div>
    <div class="stat-value neutral" style="font-size:22px;">A${{ "%.2f" | format(bs.total_equity) }}</div>
    <div class="stat-breakdown">
        At Risk: A${{ "%.2f" | format(bs.in_trades) }}
        &nbsp;&middot;&nbsp;
        Avail: A${{ "%.2f" | format(bs.available) }}
    </div>
    <div class="stat-breakdown" style="margin-top:4px;">
        <span class="{{ 'leverage-high' if bs.total_leverage > 10 else 'leverage-warn' if bs.total_leverage > 5 else 'leverage-safe' }}">
            Leverage: {{ "%.1f" | format(bs.total_leverage) }}x
        </span>
    </div>
    <div style="margin-top:8px;">
        <div class="stat-label">Daily P&L</div>
        <div class="stat-value {{ 'positive' if bs.daily_pnl >= 0 else 'negative' }}" style="font-size:18px;">
            {{ "+" if bs.daily_pnl >= 0 else "" }}A${{ "%.2f" | format(bs.daily_pnl) }}
            <span class="text-sm {{ 'text-success' if bs.daily_pnl_pct >= 0 else 'text-danger' }}">
                ({{ "+" if bs.daily_pnl_pct >= 0 else "" }}{{ "%.2f" | format(bs.daily_pnl_pct) }}%)
            </span>
        </div>
        <div class="stat-breakdown">
            Real: {{ "+" if bs.realized_pnl >= 0 else "" }}A${{ "%.2f" | format(bs.realized_pnl) }}
            &nbsp;&middot;&nbsp;
            <span class="{{ 'text-success' if bs.unrealized_pnl >= 0 else 'text-danger' }}">
                Open: {{ "+" if bs.unrealized_pnl >= 0 else "" }}A${{ "%.2f" | format(bs.unrealized_pnl) }}
            </span>
        </div>
    </div>
    <div style="display:flex; gap:16px; margin-top:8px;">
        <div>
            <div class="stat-label">Positions</div>
            <div style="font-size:16px;">{{ bs.open_positions }}</div>
        </div>
        <div>
            <div class="stat-label">Trades</div>
            <div style="font-size:16px;">{{ bs.daily_trades }}</div>
        </div>
    </div>
</div>
{% endfor %}
{% endif %}

<!-- Combined Totals -->
<div class="stat-card">
    <div class="stat-label">Combined Equity</div>
    <div class="stat-value neutral">A${{ "%.2f" | format(stats.total_equity) }}</div>
    <div class="stat-breakdown">
        At Risk: A${{ "%.2f" | format(stats.in_trades) }}
        &nbsp;&middot;&nbsp;
        Available: A${{ "%.2f" | format(stats.available) }}
    </div>
</div>

<div class="stat-card">
    <div class="stat-label">Combined Leverage</div>
    <span class="leverage-badge {{ 'leverage-high' if stats.total_leverage > 10 else 'leverage-warn' if stats.total_leverage > 5 else 'leverage-safe' }}">
        {{ "%.1f" | format(stats.total_leverage) }}x
    </span>
</div>

<div class="stat-card">
    <div class="stat-label">Combined Daily P&L</div>
    <div class="stat-value {{ 'positive' if stats.daily_pnl >= 0 else 'negative' }}">
        {{ "+" if stats.daily_pnl >= 0 else "" }}A${{ "%.2f" | format(stats.daily_pnl) }}
    </div>
    <div class="stat-change {{ 'text-success' if stats.daily_pnl_pct >= 0 else 'text-danger' }}">
        {{ "+" if stats.daily_pnl_pct >= 0 else "" }}{{ "%.2f" | format(stats.daily_pnl_pct) }}%
    </div>
    <div class="stat-breakdown">
        Realized: {{ "+" if stats.realized_pnl >= 0 else "" }}A${{ "%.2f" | format(stats.realized_pnl) }}
        &nbsp;&middot;&nbsp;
        <span class="{{ 'text-success' if stats.unrealized_pnl >= 0 else 'text-danger' }}">
            Open: {{ "+" if stats.unrealized_pnl >= 0 else "" }}A${{ "%.2f" | format(stats.unrealized_pnl) }}
        </span>
    </div>
</div>

<div class="stat-card" style="display:flex; gap:24px;">
    <div>
        <div class="stat-label">Positions</div>
        <div class="stat-value neutral" style="font-size:24px;">{{ stats.open_positions }}</div>
    </div>
    <div>
        <div class="stat-label">Trades Today</div>
        <div class="stat-value neutral" style="font-size:24px;">{{ stats.daily_trades }}</div>
    </div>
</div>
