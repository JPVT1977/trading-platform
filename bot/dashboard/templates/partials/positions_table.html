<!-- Positions HTMX partial â€” re-renders both tabs -->
<div class="tabs">
    <button class="tab active" data-tab-group="positions" data-tab="open"
            onclick="switchTab('positions', 'open')">
        Open ({{ open_positions | length }})
    </button>
    <button class="tab" data-tab-group="positions" data-tab="closed"
            onclick="switchTab('positions', 'closed')">
        Closed ({{ closed_total }})
    </button>
</div>

<div data-tab-content="positions" data-tab-pane="open">
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Direction</th>
                    <th>Entry</th>
                    <th>SL</th>
                    <th>TP1</th>
                    <th>Qty</th>
                    <th>State</th>
                    <th>Opened</th>
                </tr>
            </thead>
            <tbody>
                {% for p in open_positions %}
                <tr>
                    <td><strong>{{ p.symbol }}</strong></td>
                    <td><span class="badge badge-{{ p.direction }}">{{ p.direction }}</span></td>
                    <td class="mono">{{ "%.2f" | format(p.entry_price) }}</td>
                    <td class="mono">{{ "%.2f" | format(p.stop_loss) }}</td>
                    <td class="mono">{{ "%.2f" | format(p.take_profit_1) }}</td>
                    <td class="mono">{{ "%.6f" | format(p.quantity) }}</td>
                    <td><span class="badge badge-info">{{ p.state }}</span></td>
                    <td class="mono text-sm">{{ p.created_at.strftime('%m-%d %H:%M') }}</td>
                </tr>
                {% else %}
                <tr><td colspan="8" class="text-muted" style="text-align:center;padding:32px;">No open positions</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div data-tab-content="positions" data-tab-pane="closed" style="display:none;">
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Direction</th>
                    <th>Entry</th>
                    <th>Fill</th>
                    <th>P&L</th>
                    <th>Fees</th>
                    <th>Closed</th>
                </tr>
            </thead>
            <tbody>
                {% for p in closed_positions %}
                <tr>
                    <td><strong>{{ p.symbol }}</strong></td>
                    <td><span class="badge badge-{{ p.direction }}">{{ p.direction }}</span></td>
                    <td class="mono">{{ "%.2f" | format(p.entry_price) }}</td>
                    <td class="mono">{{ "%.2f" | format(p.filled_price) if p.filled_price else '-' }}</td>
                    <td class="mono {{ 'text-success' if p.pnl and p.pnl >= 0 else 'text-danger' }}">
                        {{ "%.2f" | format(p.pnl) if p.pnl is not none else '-' }}
                    </td>
                    <td class="mono text-muted">{{ "%.2f" | format(p.fees) if p.fees else '0.00' }}</td>
                    <td class="mono text-sm">{{ p.closed_at.strftime('%m-%d %H:%M') if p.closed_at else '-' }}</td>
                </tr>
                {% else %}
                <tr><td colspan="7" class="text-muted" style="text-align:center;padding:32px;">No closed positions</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
